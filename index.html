<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Grocery App</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <style>
        @media print {
            body * {
                visibility: hidden;
            }
            #customer-products-modal, #customer-products-modal * {
                visibility: visible;
            }
            #customer-products-modal {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: visible;
            }
            #customer-products-modal .modal-content {
                margin: 0;
                padding: 0;
                border: none;
                box-shadow: none;
                width: 100%;
            }
            #customer-products-modal button {
                display: none;
            }
            #customer-product-table {
                width: 100%;
                border-collapse: collapse;
            }
            #customer-product-table th, #customer-product-table td {
                border: 1px solid #000;
                padding: 8px;
                text-align: left;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <nav>
        <ul>
            <li><a href='#'>Berakah's Fresh</a></li>
            <li class='desktopMenu'><a href='#' onclick="showPage('products')">Product List</a></li>
            <li class='desktopMenu'><a href='#' onclick="showPage('customers')">Customers</a></li>
            <li class='menu-button' onclick="showSidebar()">
                <svg xmlns="http://www.w3.org/2000/svg" height="26" viewBox="0 0 960 960" width="26">
                    <path d="M120 186v-60h720v60H120Zm0 210v-60h720v60H120Zm0 210v-60h720v60H120Z"/>
                </svg>
            </li>
        </ul>
    </nav>
    <div class="sidebar" id="sidebar">
        <ul>
            <li onclick="hideSidebar()">
                <a href="#">
                    <svg xmlns="http://www.w3.org/2000/svg" height="26" viewBox="0 0 960 960" width="26">
                        <path d="m249 849-42-42 231-231-231-231 42-42 231 231 231-231 42 42-231 231 231 231-42 42-231-231-231 2312"/>
                    </svg>
                </a>
            </li>
            <li><a href="#" onclick="showPage('products')">Product List</a></li>
            <li><a href="#" onclick="showPage('customers')">Customers</a></li>
        </ul>
    </div>
    <div class="container" id="products" style="display: none;">
        <h1>Product List</h1>
        <form id="product-form">
            <input type="text" id="product-name" placeholder="Product Name" required>
            <input type="number" step="0.01" id="product-price" placeholder="Price per Kilo/Unit" required>
            <button type="submit">Add Product</button>
        </form>
        <div id="product-list"></div>
        <button onclick="downloadProductsPDF()">Download Products as PDF</button>
    </div>
    <div class="container" id="customers" style="display: none;">
        <h1>Customers</h1>
        <form id="customer-form">
            <input type="text" id="customer-name" placeholder="Customer Name" required>
            <input type="text" id="customer-contact" placeholder="Contact Information" required>
            <input type="tel" id="customer-telephone" placeholder="Telephone Number" required>
            <button type="submit">Add Customer</button>
        </form>
        <div id="customer-list"></div>
    </div>

    <!-- Customer Products Modal -->
    <div id="customer-products-modal" style="display: none;">
        <div class="modal-content">
            <h2>Manage Products for <span id="customer-name-modal"></span></h2>
            <p>Contact Information: <span id="customer-contact-modal"></span></p>
            <p>Telephone: <span id="customer-telephone-modal"></span></p>
            <form id="customer-product-form">
                <select id="select-product">
                    <!-- Options will be added dynamically -->
                </select>
                <input type="number" step="0.01" id="product-quantity" placeholder="Quantity" required>
                <button type="submit">Add Product</button>
            </form>
            <div id="customer-product-list">
                <table id="customer-product-table">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Quantity</th>
                            <th>Price per Unit</th>
                            <th>Total</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Product rows will be added dynamically -->
                    </tbody>
                </table>
            </div>
            <div id="total-cost">Total: ₱0.00</div>
            <button onclick="generatePDF()">Download PDF</button>
            <button onclick="closeCustomerProductsModal()">Close</button>
        </div>
    </div>

    <script>
        // Show and hide sidebar
        function showSidebar() {
            document.getElementById('sidebar').style.display = "flex";
        }

        function hideSidebar() {
            document.getElementById('sidebar').style.display = "none";
        }

        // Show and hide pages
        function showPage(page) {
            document.getElementById('products').style.display = 'none';
            document.getElementById('customers').style.display = 'none';
            document.getElementById(page).style.display = 'block';
            hideSidebar();
        }

        // Local Storage Functions
        function saveToLocalStorage(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        function loadFromLocalStorage(key) {
            return JSON.parse(localStorage.getItem(key)) || [];
        }

        // Products
        function renderProducts() {
            const products = loadFromLocalStorage('products');
            const productList = document.getElementById('product-list');
            productList.innerHTML = '';
            products.forEach(product => {
                const productItem = document.createElement('div');
                productItem.classList.add('product-item');
                productItem.innerHTML = `
                    <span>${product.name} - ₱${product.price}</span>
                    <button onclick="deleteProduct('${product.name}')">Delete</button>
                `;
                productList.appendChild(productItem);
            });

            // Populate select dropdown in customer products modal
            const selectProduct = document.getElementById('select-product');
            selectProduct.innerHTML = '';
            products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.name;
                option.innerText = `${product.name} - ₱${product.price}`;
                selectProduct.appendChild(option);
            });
        }

        document.getElementById('product-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const name = document.getElementById('product-name').value;
            const price = parseFloat(document.getElementById('product-price').value).toFixed(2);

            const products = loadFromLocalStorage('products');
            products.push({ name, price });
            saveToLocalStorage('products', products);

            renderProducts();
            document.getElementById('product-form').reset();
        });

        function deleteProduct(name) {
            let products = loadFromLocalStorage('products');
            products = products.filter(product => product.name !== name);
            saveToLocalStorage('products', products);
            renderProducts();
        }

        // Customers
        function renderCustomers() {
            const customers = loadFromLocalStorage('customers');
            const customerList = document.getElementById('customer-list');
            customerList.innerHTML = '';
            customers.forEach(customer => {
                const customerItem = document.createElement('div');
                customerItem.classList.add('customer-item');
                customerItem.innerHTML = `
                    <span>${customer.name} - ${customer.contact} - ${customer.telephone}</span>
                    <button onclick="deleteCustomer('${customer.name}')">Delete</button>
                    <button onclick="openCustomerProductsModal('${customer.name}', '${customer.contact}', '${customer.telephone}')">Manage Products</button>
                `;
                customerList.appendChild(customerItem);
            });
        }

        document.getElementById('customer-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const name = document.getElementById('customer-name').value;
            const contact = document.getElementById('customer-contact').value;
            const telephone = document.getElementById('customer-telephone').value;

            const customers = loadFromLocalStorage('customers');
            customers.push({ name, contact, telephone, products: [] });
            saveToLocalStorage('customers', customers);

            renderCustomers();
            document.getElementById('customer-form').reset();
        });

        function deleteCustomer(name) {
            let customers = loadFromLocalStorage('customers');
            customers = customers.filter(customer => customer.name !== name);
            saveToLocalStorage('customers', customers);
            renderCustomers();
        }

        function openCustomerProductsModal(name, contact, telephone) {
            document.getElementById('customer-name-modal').innerText = name;
            document.getElementById('customer-contact-modal').innerText = contact;
            document.getElementById('customer-telephone-modal').innerText = telephone;

            const products = loadFromLocalStorage('products');
            const selectProduct = document.getElementById('select-product');
            selectProduct.innerHTML = '';
            products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.name;
                option.innerText = `${product.name} - ₱${product.price}`;
                selectProduct.appendChild(option);
            });

            const customers = loadFromLocalStorage('customers');
            const customer = customers.find(c => c.name === name);
            if (customer) {
                loadCustomerProductsTable(customer);
            }

            document.getElementById('customer-products-modal').style.display = 'block';
        }

        function loadCustomerProductsTable(customer) {
            const tableBody = document.getElementById('customer-product-table').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';
            let totalCost = 0;
            customer.products.forEach((product, index) => {
                const row = tableBody.insertRow();
                row.insertCell(0).innerText = product.name;
                row.insertCell(1).innerText = product.quantity;
                row.insertCell(2).innerText = `₱${product.price}`;
                row.insertCell(3).innerText = `₱${(product.quantity * product.price).toFixed(2)}`;
                const actionCell = row.insertCell(4);
                const deleteButton = document.createElement('button');
                deleteButton.innerText = 'Delete';
                deleteButton.onclick = () => deleteCustomerProduct(index);
                actionCell.appendChild(deleteButton);
                totalCost += product.quantity * product.price;
            });
            document.getElementById('total-cost').innerText = `Total: ₱${totalCost.toFixed(2)}`;
        }

        function deleteCustomerProduct(index) {
            const customerName = document.getElementById('customer-name-modal').innerText;
            const customers = loadFromLocalStorage('customers');
            const customer = customers.find(c => c.name === customerName);
            if (customer) {
                customer.products.splice(index, 1);
                saveToLocalStorage('customers', customers);
                loadCustomerProductsTable(customer);
            }
        }

        document.getElementById('customer-product-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const name = document.getElementById('select-product').value;
            const quantity = parseFloat(document.getElementById('product-quantity').value);
            const price = loadFromLocalStorage('products').find(p => p.name === name).price;

            const customerName = document.getElementById('customer-name-modal').innerText;
            const customers = loadFromLocalStorage('customers');
            const customer = customers.find(c => c.name === customerName);

            if (customer) {
                customer.products.push({ name, quantity, price });
                saveToLocalStorage('customers', customers);
                loadCustomerProductsTable(customer);
                document.getElementById('customer-product-form').reset();
            }
        });

        function closeCustomerProductsModal() {
            document.getElementById('customer-products-modal').style.display = 'none';
        }

        // Generate PDF for Products
        async function downloadProductsPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            let y = 10;

            doc.setFontSize(16);
            doc.text('Product List', 10, y);
            y += 10;

            // Table headers
            doc.setFontSize(12);
            doc.text('Product', 10, y);
            doc.text('Price per Kilo/Unit', 100, y);
            y += 10;

            // Draw line under headers
            doc.line(10, y, 200, y);
            y += 5;

            const products = loadFromLocalStorage('products');
            products.forEach(product => {
                doc.text(product.name, 10, y);
                doc.text(`PHP${product.price}`, 100, y);
                y += 10;
            });

            doc.save('products_list.pdf');
        }

        // Generate PDF for Customer Products
        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
        
            const customerName = document.getElementById('customer-name-modal').innerText;
            const customerContact = document.getElementById('customer-contact-modal').innerText;
            const customerTelephone = document.getElementById('customer-telephone-modal').innerText;
        
            let y = 10;
        
            doc.setFontSize(16);
            doc.text(`Customer Name: ${customerName}`, 10, y);
            y += 10;
            doc.setFontSize(14);
            doc.text(`Contact Information: ${customerContact}`, 10, y);
            y += 10;
            doc.text(`Telephone: ${customerTelephone}`, 10, y);
            y += 20;
        
            doc.setFontSize(14);
            doc.text('Products', 10, y);
            y += 10;
        
            // Table headers
            doc.setFontSize(12);
            doc.text('Product', 10, y);
            doc.text('Quantity', 60, y);
            doc.text('Price per Unit', 100, y);
            doc.text('Total', 150, y);
            y += 10;
        
            // Draw line under headers
            doc.line(10, y, 200, y);
            y += 5;
        
            const table = document.getElementById('customer-product-table');
            const rows = table.querySelectorAll('tr');
        
            rows.forEach((row, index) => {
                if (index === 0) return; // Skip header row
        
                const cells = row.querySelectorAll('td');
                doc.text(cells[0].innerText, 10, y);
                doc.text(cells[1].innerText, 60, y);
                doc.text(cells[2].innerText.replace('₱', 'PHP'), 100, y); // Replace ₱ with PHP
                doc.text(cells[3].innerText.replace('₱', 'PHP'), 150, y); // Replace ₱ with PHP
                y += 10;
            });
        
            y += 10;
            doc.text(`Total Cost: ${document.getElementById('total-cost').innerText.replace('₱', 'PHP')}`, 10, y); // Replace ₱ with PHP
        
            doc.save(`${customerName}_invoice.pdf`);
        }
        
        window.onload = function() {
            renderProducts();
            renderCustomers();
        };
    </script>
</body>
</html>
